{"version":3,"file":"index.mjs","sources":["../../src/utils.js","../../src/coreTypeHandler.js","../../src/coreComponents.js","../../src/SettingsUI.js"],"sourcesContent":["export const cast = (value, type) => {\n  switch (type) {\n    case 'number':\n      return parseFloat(value);\n    case 'text':\n      return value + '';\n  }\n  return value;\n};\n","import { section, selection, input } from './coreComponents.js';\n\nexport default [\n  (value, update) => {\n    if (value.type === 'section') {\n      return section(value, update);\n    }\n  },\n  (value, update) => {\n    if (value.values) {\n      return selection(value, update);\n    }\n  },\n  (value, update) => {\n    return input(value, update);\n  },\n];\n","export const section = ({ id, name }) => {\n  const elementCreator = type => document.createElement(type);\n  const e = elementCreator('b');\n  e.innerHTML = name || id;\n  return {\n    htmlElements: [e],\n    superType: true,\n  };\n};\n\nexport const input = (\n  { id, name, type = 'text', help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = type;\n  input.id = id;\n  if (type === 'number') {\n    input.min = min || 0;\n    if (max || max === 0) input.max = max;\n    if (steps) input.step = steps;\n  } else {\n    input.minLength = min || 0;\n    if (max) input.maxLength = max;\n  }\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.value));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  return { htmlElements };\n};\n\nexport const selection = ({ id, name, help, values, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const select = elementCreator('select');\n  select.id = id;\n  select.title = help || '';\n\n  values.forEach(v => {\n    const option = elementCreator('option');\n    if (typeof v === 'object') {\n      option.value = v.value;\n      option.innerHTML = v.name;\n    } else {\n      option.value = option.innerHTML = v;\n    }\n    select.appendChild(option);\n  });\n\n  if (defaultValue || defaultValue === 0) select.value = defaultValue;\n\n  select.addEventListener('input', e => update(e.target.value));\n\n  const label = document.createElement('label');\n  label.htmlFor = id;\n  label.innerHTML = name || id;\n\n  htmlElements.push(label);\n  htmlElements.push(select);\n\n  return { htmlElements };\n};\n","import { cast } from './utils.js';\nimport coreTypeHandler from './coreTypeHandler.js';\nimport './main.scss';\n\nconst bindElements = (\n  template,\n  config,\n  htmlElements,\n  typeHandler,\n  onValueUpdated\n) => {\n  Object.values(template).forEach(templateComponent => {\n    const { id, type, defaultValue, options, onUpdate } = templateComponent;\n    for (const handle of typeHandler) {\n      const wrapper = handle(templateComponent, newValue => {\n        newValue = cast(newValue, type);\n        if (newValue !== 0 && !newValue) {\n          newValue = defaultValue || null;\n        }\n\n        if (typeof onUpdate === 'function') {\n          const v = onUpdate(newValue, config[id]);\n          config[id] = v !== undefined ? v : newValue;\n        } else config[id] = newValue;\n        onValueUpdated(id, newValue);\n      });\n\n      if (wrapper) {\n        if (wrapper.superType) {\n          htmlElements.push(...(wrapper.htmlElements || []));\n          config[id] = {};\n          bindElements(\n            options,\n            config[id],\n            htmlElements,\n            typeHandler,\n            onValueUpdated\n          );\n          return;\n        }\n\n        config[id] = defaultValue || null;\n\n        htmlElements.push(...(wrapper.htmlElements || []));\n        break;\n      }\n    }\n  });\n};\n\nconst SettingsUI = ({ plugins = [] } = {}) => {\n  const changeListener = [];\n  const htmlElements = [];\n  return {\n    bind(template, config = {}) {\n      bindElements(\n        template,\n        config,\n        htmlElements,\n        [...coreTypeHandler, ...plugins],\n        (id, newValue) => changeListener.forEach(l => l(id, newValue))\n      );\n      return config;\n    },\n    addChangeListener(listener) {\n      changeListener.push(listener);\n    },\n    removeChangeListener(listener) {\n      changeListener.splice(changeListener.indexOf(listener));\n    },\n    render(tag = 'div') {\n      const wrapper = document.createElement(tag);\n      wrapper.className = 'settings-ui-wrapper';\n      htmlElements.forEach(e => wrapper.appendChild(e));\n      return {\n        to(element) {\n          element.appendChild(wrapper);\n          return wrapper;\n        },\n        replace(element) {\n          element.parentElement.replaceChild(wrapper, element);\n          return wrapper;\n        },\n        get() {\n          return wrapper;\n        },\n      };\n    },\n  };\n};\n\nexport default SettingsUI;\n"],"names":["const","cast","value","type","parseFloat","update","e","document","createElement","innerHTML","name","id","htmlElements","superType","values","elementCreator","select","title","help","forEach","v","option","appendChild","defaultValue","addEventListener","target","label","htmlFor","push","selection","input","min","max","steps","step","minLength","maxLength","placeholder","bindElements","template","config","typeHandler","onValueUpdated","Object","templateComponent","wrapper","handle","newValue","onUpdate","undefined","options","changeListener","bind","coreTypeHandler","plugins","l","addChangeListener","listener","removeChangeListener","splice","indexOf","render","tag","className","to","element","replace","parentElement","replaceChild","get"],"mappings":"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"}