{"version":3,"file":"index.mjs","sources":["../../src/utils.js","../../src/coreComponents.js","../../src/coreTypeHandler.js","../../src/SettingsUI.js"],"sourcesContent":["export const cast = (value, type) => {\n  switch (type) {\n    case 'number':\n      return parseFloat(value);\n    case 'text':\n      return value + '';\n  }\n  return value;\n};\n","export const section = ({ id, name }) => {\n  const elementCreator = type => document.createElement(type);\n  const e = elementCreator('b');\n  e.innerHTML = name || id;\n  return {\n    htmlElements: [e],\n    superType: true,\n  };\n};\n\nexport const input = (\n  { id, name, type = 'text', help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = type;\n  input.id = id;\n  if (type === 'number') {\n    if (typeof min === 'number') input.min = min;\n    if (typeof max === 'number') input.max = max;\n    if (typeof steps === 'number') input.steps = steps;\n  } else {\n    if (typeof min === 'number') input.minLength = min;\n    if (typeof max === 'number') input.maxLength = max;\n  }\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.value));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  return { htmlElements };\n};\n\nexport const selection = ({ id, name, help, values, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const select = elementCreator('select');\n  select.id = id;\n  select.title = help || '';\n\n  values.forEach(v => {\n    const option = elementCreator('option');\n    if (typeof v === 'object') {\n      option.value = v.value;\n      option.innerHTML = v.name;\n    } else {\n      option.value = option.innerHTML = v;\n    }\n    select.appendChild(option);\n  });\n\n  if (defaultValue || defaultValue === 0) select.value = defaultValue;\n\n  select.addEventListener('input', e => update(e.target.value));\n\n  const label = document.createElement('label');\n  label.htmlFor = id;\n  label.innerHTML = name || id;\n\n  htmlElements.push(label);\n  htmlElements.push(select);\n\n  return { htmlElements };\n};\n\nexport const slider = (\n  { id, name, help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = 'range';\n  input.id = id;\n  input.min = min || 0;\n  if (max || max === 0) input.max = max;\n  if (steps) input.step = steps;\n\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  const output = elementCreator('output');\n  output.innerHTML = input.value;\n\n  input.addEventListener('input', e => {\n    output.innerHTML = e.target.value;\n    update(e.target.value);\n  });\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  htmlElements.push(output);\n  return { htmlElements };\n};\n\nexport const checkbox = ({ id, name, help, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = 'checkbox';\n  input.id = id;\n  input.title = help || '';\n  if (typeof defaultValue === 'boolean') input.checked = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.checked));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(input);\n  htmlElements.push(label);\n\n  return { htmlElements };\n};\n\nexport const radio = ({ id, values, defaultValue, help }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  values.forEach(v => {\n    const radio = elementCreator('input');\n    radio.type = 'radio';\n    radio.name = id;\n    radio.title = help || '';\n\n    const label = document.createElement('label');\n\n    if (typeof v === 'object') {\n      radio.value = v.value;\n      radio.id = `${id}_${v.value}`;\n      label.innerHTML = v.name;\n    } else {\n      radio.value = label.innerHTML = v;\n      radio.id = `${id}_${v}`;\n    }\n\n    if (defaultValue + '' === radio.value + '') radio.checked = true;\n\n    radio.addEventListener('click', e => update(e.target.value));\n\n    label.htmlFor = radio.id;\n\n    htmlElements.push(radio);\n    htmlElements.push(label);\n  });\n\n  return { htmlElements };\n};\n","import {\n  section,\n  selection,\n  input,\n  slider,\n  checkbox,\n  radio,\n} from './coreComponents.js';\n\nexport default [\n  (value, update) => {\n    if (value.inputType === 'input') return input(value, update);\n  },\n  (value, update) => {\n    if (value.type === 'section') {\n      return section(value, update);\n    }\n  },\n  (value, update) => {\n    if (value.type === 'boolean') return checkbox(value, update);\n  },\n  (value, update) => {\n    if (value.values) {\n      if (value.inputType === 'radio') return radio(value, update);\n      if (value.inputType === 'selection') return selection(value, update);\n      if (value.values.length < 5) return radio(value, update);\n      else return selection(value, update);\n    }\n  },\n  (value, update) => {\n    if (\n      value.type === 'number' &&\n      !value.values &&\n      typeof value.min === 'number' &&\n      typeof value.max === 'number' &&\n      (!value.steps || value.steps >= (value.min + value.max) / 1000) // no slider for big values\n    )\n      return slider(value, update);\n  },\n  (value, update) => {\n    return input(value, update);\n  },\n];\n","import { cast } from './utils.js';\nimport coreTypeHandler from './coreTypeHandler.js';\nimport './main.scss';\n\nconst bindElements = (\n  template,\n  config,\n  htmlElements,\n  typeHandler,\n  onValueUpdated\n) => {\n  Object.values(template).forEach(templateComponent => {\n    const { id, type, defaultValue, options, onUpdate } = templateComponent;\n    for (const handle of typeHandler) {\n      const wrapper = handle(templateComponent, newValue => {\n        newValue = cast(newValue, type);\n        if (newValue !== 0 && newValue !== false && !newValue) {\n          newValue = defaultValue || null;\n        }\n\n        if (typeof onUpdate === 'function') {\n          const v = onUpdate(newValue, config[id]);\n          config[id] = v !== undefined ? v : newValue;\n        } else config[id] = newValue;\n        onValueUpdated(id, newValue);\n      });\n\n      if (wrapper) {\n        if (wrapper.superType) {\n          htmlElements.push(...(wrapper.htmlElements || []));\n          config[id] = {};\n          bindElements(\n            options,\n            config[id],\n            htmlElements,\n            typeHandler,\n            onValueUpdated\n          );\n          return;\n        }\n\n        config[id] = defaultValue || null;\n\n        htmlElements.push(...(wrapper.htmlElements || []));\n        break;\n      }\n    }\n  });\n};\n\nconst SettingsUI = ({ plugins = [] } = {}) => {\n  const changeListener = [];\n  const htmlElements = [];\n  return {\n    bind(template, config = {}) {\n      bindElements(\n        template,\n        config,\n        htmlElements,\n        [...coreTypeHandler, ...plugins],\n        (id, newValue) => changeListener.forEach(l => l(id, newValue))\n      );\n      return config;\n    },\n    addChangeListener(listener) {\n      changeListener.push(listener);\n    },\n    removeChangeListener(listener) {\n      changeListener.splice(changeListener.indexOf(listener));\n    },\n    render(tag = 'div') {\n      const wrapper = document.createElement(tag);\n      wrapper.className = 'settings-ui-wrapper';\n      htmlElements.forEach(e => wrapper.appendChild(e));\n      return {\n        to(element) {\n          element.appendChild(wrapper);\n          return wrapper;\n        },\n        replace(element) {\n          element.parentElement.replaceChild(wrapper, element);\n          return wrapper;\n        },\n        get() {\n          return wrapper;\n        },\n      };\n    },\n  };\n};\n\nexport default SettingsUI;\n"],"names":["cast","value","type","parseFloat","input","update","id","name","help","defaultValue","min","max","steps","htmlElements","elementCreator","document","createElement","minLength","maxLength","placeholder","addEventListener","e","target","label","innerHTML","htmlFor","push","selection","values","select","title","forEach","v","option","appendChild","radio","checked","inputType","superType","checkbox","length","step","output","slider","plugins","changeListener","bind","template","config","bindElements","typeHandler","onValueUpdated","Object","templateComponent","options","onUpdate","wrapper","handle","newValue","undefined","coreTypeHandler","l","addChangeListener","listener","removeChangeListener","splice","indexOf","render","tag","className","to","element","replace","parentElement","replaceChild","get"],"mappings":"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"}