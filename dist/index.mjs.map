{"version":3,"file":"index.mjs","sources":["../../src/utils.js","../../src/coreComponents.js","../../src/coreTypeHandler.js","../../src/SettingsUI.js"],"sourcesContent":["export const cast = (value, type) => {\n  switch (type) {\n    case 'number':\n      return parseFloat(value);\n    case 'text':\n      return value + '';\n  }\n  return value;\n};\n","export const section = ({ id, name }) => {\n  const elementCreator = type => document.createElement(type);\n  const e = elementCreator('b');\n  e.innerHTML = name || id;\n  return {\n    htmlElements: [e],\n    superType: true,\n  };\n};\n\nexport const input = (\n  { id, name, type = 'text', help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = type;\n  input.id = id;\n  if (type === 'number') {\n    if (typeof min === 'number') input.min = min;\n    if (typeof max === 'number') input.max = max;\n    if (typeof steps === 'number') input.steps = steps;\n  } else {\n    if (typeof min === 'number') input.minLength = min;\n    if (typeof max === 'number') input.maxLength = max;\n  }\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.value));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  return { htmlElements };\n};\n\nexport const selection = ({ id, name, help, values, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const select = elementCreator('select');\n  select.id = id;\n  select.title = help || '';\n\n  values.forEach(v => {\n    const option = elementCreator('option');\n    if (typeof v === 'object') {\n      option.value = v.value;\n      option.innerHTML = v.name;\n    } else {\n      option.value = option.innerHTML = v;\n    }\n    select.appendChild(option);\n  });\n\n  if (defaultValue || defaultValue === 0) select.value = defaultValue;\n\n  select.addEventListener('input', e => update(e.target.value));\n\n  const label = document.createElement('label');\n  label.htmlFor = id;\n  label.innerHTML = name || id;\n\n  htmlElements.push(label);\n  htmlElements.push(select);\n\n  return { htmlElements };\n};\n\nexport const slider = (\n  { id, name, help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = 'range';\n  input.id = id;\n  input.min = min || 0;\n  if (max || max === 0) input.max = max;\n  if (steps) input.step = steps;\n\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  const output = elementCreator('output');\n  output.innerHTML = input.value;\n\n  input.addEventListener('input', e => {\n    output.innerHTML = e.target.value;\n    update(e.target.value);\n  });\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  htmlElements.push(output);\n  return { htmlElements };\n};\n\nexport const checkbox = ({ id, name, help, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = 'checkbox';\n  input.id = id;\n  input.title = help || '';\n  if (typeof defaultValue === 'boolean') input.checked = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.checked));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(input);\n  htmlElements.push(label);\n\n  return { htmlElements };\n};\n\nexport const radio = ({ id, values, defaultValue, help }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  values.forEach(v => {\n    const radio = elementCreator('input');\n    radio.type = 'radio';\n    radio.name = id;\n    radio.title = help || '';\n\n    const label = document.createElement('label');\n\n    if (typeof v === 'object') {\n      radio.value = v.value;\n      radio.id = `${id}_${v.value}`;\n      label.innerHTML = v.name;\n    } else {\n      radio.value = label.innerHTML = v;\n      radio.id = `${id}_${v}`;\n    }\n\n    if (defaultValue + '' === radio.value + '') radio.checked = true;\n\n    radio.addEventListener('click', e => update(e.target.value));\n\n    label.htmlFor = radio.id;\n\n    htmlElements.push(radio);\n    htmlElements.push(label);\n  });\n\n  return { htmlElements };\n};\n","import {\n  section,\n  selection,\n  input,\n  slider,\n  checkbox,\n  radio,\n} from './coreComponents.js';\n\nexport default [\n  (value, update) => {\n    if (value.inputType === 'input') return input(value, update);\n  },\n  (value, update) => {\n    if (value.type === 'section') {\n      return section(value, update);\n    }\n  },\n  (value, update) => {\n    if (value.type === 'boolean') return checkbox(value, update);\n  },\n  (value, update) => {\n    if (value.values) {\n      if (value.inputType === 'radio') return radio(value, update);\n      if (value.inputType === 'selection') return selection(value, update);\n      if (value.values.length < 5) return radio(value, update);\n      else return selection(value, update);\n    }\n  },\n  (value, update) => {\n    if (\n      value.type === 'number' &&\n      !value.values &&\n      typeof value.min === 'number' &&\n      typeof value.max === 'number' &&\n      (!value.steps || value.steps >= (value.min + value.max) / 1000) // no slider for big values\n    )\n      return slider(value, update);\n  },\n  (value, update) => {\n    return input(value, update);\n  },\n];\n","import { cast } from './utils.js';\nimport coreTypeHandler from './coreTypeHandler.js';\nimport './main.scss';\n\nconst bindElements = (\n  template,\n  config,\n  htmlElements,\n  typeHandler,\n  onValueUpdated\n) => {\n  Object.values(template).forEach(templateComponent => {\n    const { id, type, defaultValue, options, onUpdate } = templateComponent;\n    for (const handle of typeHandler) {\n      const wrapper = handle(templateComponent, newValue => {\n        newValue = cast(newValue, type);\n        if (newValue !== 0 && newValue !== false && !newValue) {\n          newValue = defaultValue || null;\n        }\n\n        if (typeof onUpdate === 'function') {\n          const v = onUpdate(newValue, config[id]);\n          config[id] = v !== undefined ? v : newValue;\n        } else config[id] = newValue;\n        onValueUpdated(id, newValue);\n      });\n\n      if (wrapper) {\n        if (wrapper.superType) {\n          htmlElements.push(...(wrapper.htmlElements || []));\n          config[id] = {};\n          bindElements(\n            options,\n            config[id],\n            htmlElements,\n            typeHandler,\n            onValueUpdated\n          );\n          return;\n        }\n\n        config[id] = defaultValue || null;\n\n        htmlElements.push(...(wrapper.htmlElements || []));\n        break;\n      }\n    }\n  });\n};\n\nconst SettingsUI = ({ plugins = [] } = {}) => {\n  const changeListener = [];\n  const htmlElements = [];\n  return {\n    bind(template, config = {}) {\n      bindElements(\n        template,\n        config,\n        htmlElements,\n        [...coreTypeHandler, ...plugins],\n        (id, newValue) => changeListener.forEach(l => l(id, newValue))\n      );\n      return config;\n    },\n    addChangeListener(listener) {\n      changeListener.push(listener);\n    },\n    removeChangeListener(listener) {\n      changeListener.splice(changeListener.indexOf(listener));\n    },\n    render(tag = 'div') {\n      const wrapper = document.createElement(tag);\n      wrapper.className = 'settings-ui-wrapper';\n      htmlElements.forEach(e => wrapper.appendChild(e));\n      return {\n        to(element) {\n          element.appendChild(wrapper);\n          return wrapper;\n        },\n        replace(element) {\n          element.parentElement.replaceChild(wrapper, element);\n          return wrapper;\n        },\n        get() {\n          return wrapper;\n        },\n      };\n    },\n  };\n};\n\nexport default SettingsUI;\n"],"names":["const","cast","value","type","parseFloat","input","update","htmlElements","elementCreator","document","createElement","id","min","max","steps","minLength","maxLength","placeholder","help","defaultValue","addEventListener","e","target","label","innerHTML","name","htmlFor","push","selection","select","title","values","forEach","v","option","appendChild","radio","checked","inputType","superType","checkbox","length","step","output","slider","bindElements","template","config","typeHandler","onValueUpdated","Object","templateComponent","wrapper","handle","newValue","onUpdate","undefined","options","changeListener","bind","coreTypeHandler","plugins","l","addChangeListener","listener","removeChangeListener","splice","indexOf","render","tag","className","to","element","replace","parentElement","replaceChild","get"],"mappings":"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"}