{"version":3,"file":"index.mjs","sources":["../../src/utils.js","../../src/coreComponents.js","../../src/coreTypeHandler.js","../../src/SettingsUI.js"],"sourcesContent":["export const cast = (value, type) => {\n  switch (type) {\n    case 'number':\n      return parseFloat(value);\n    case 'text':\n      return value + '';\n  }\n  return value;\n};\n","export const section = ({ id, name }) => {\n  const elementCreator = type => document.createElement(type);\n  const e = elementCreator('b');\n  e.innerHTML = name || id;\n  return {\n    htmlElements: [e],\n  };\n};\n\nexport const input = (\n  { id, name, type = 'text', help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = type;\n  input.id = id;\n  if (type === 'number') {\n    if (typeof min === 'number') input.min = min;\n    if (typeof max === 'number') input.max = max;\n    if (typeof steps === 'number') input.steps = steps;\n  } else {\n    if (typeof min === 'number') input.minLength = min;\n    if (typeof max === 'number') input.maxLength = max;\n  }\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.value));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  return {\n    htmlElements,\n    onStoreUpdate(newValue) {\n      input.value = newValue;\n    },\n  };\n};\n\nexport const selection = ({ id, name, help, values, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const select = elementCreator('select');\n  select.id = id;\n  select.title = help || '';\n\n  values.forEach(v => {\n    const option = elementCreator('option');\n    if (typeof v === 'object') {\n      option.value = v.value;\n      option.innerHTML = v.name;\n    } else {\n      option.value = option.innerHTML = v;\n    }\n    select.appendChild(option);\n  });\n\n  if (defaultValue || defaultValue === 0) select.value = defaultValue;\n\n  select.addEventListener('input', e => update(e.target.value));\n\n  const label = document.createElement('label');\n  label.htmlFor = id;\n  label.innerHTML = name || id;\n\n  htmlElements.push(label);\n  htmlElements.push(select);\n\n  return {\n    htmlElements,\n    onStoreUpdate(newValue) {\n      select.value = newValue;\n    },\n  };\n};\n\nexport const slider = (\n  { id, name, help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = 'range';\n  input.id = id;\n  input.min = min || 0;\n  if (max || max === 0) input.max = max;\n  if (steps) input.step = steps;\n\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  const output = elementCreator('output');\n  output.innerHTML = input.value;\n\n  input.addEventListener('input', e => {\n    output.innerHTML = e.target.value;\n    update(e.target.value);\n  });\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  htmlElements.push(output);\n  return {\n    htmlElements,\n    onStoreUpdate(newValue) {\n      input.value = newValue;\n      output.innerHTML = newValue;\n    },\n  };\n};\n\nexport const checkbox = ({ id, name, help, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = 'checkbox';\n  input.id = id;\n  input.title = help || '';\n  if (typeof defaultValue === 'boolean') input.checked = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.checked));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(input);\n  htmlElements.push(label);\n\n  return {\n    htmlElements,\n    onStoreUpdate(newValue) {\n      input.checked = !!newValue;\n    },\n  };\n};\n\nexport const radio = ({ id, values, defaultValue, help }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  values.forEach(v => {\n    const radio = elementCreator('input');\n    radio.type = 'radio';\n    radio.name = id;\n    radio.title = help || '';\n\n    const label = document.createElement('label');\n\n    if (typeof v === 'object') {\n      radio.value = v.value;\n      radio.id = `${id}_${v.value}`;\n      label.innerHTML = v.name;\n    } else {\n      radio.value = label.innerHTML = v;\n      radio.id = `${id}_${v}`;\n    }\n\n    if (defaultValue + '' === radio.value + '') radio.checked = true;\n\n    radio.addEventListener('click', e => update(e.target.value));\n\n    label.htmlFor = radio.id;\n\n    htmlElements.push(radio);\n    htmlElements.push(label);\n  });\n\n  return {\n    htmlElements,\n    onStoreUpdate(newValue) {\n      const e = htmlElements.find(e => e.value === newValue + '');\n      if (e) {\n        e.checked = true;\n      } else {\n        htmlElements.forEach(e => {\n          if (e.tagName === 'INPUT') {\n            e.checked = false;\n          }\n        });\n      }\n    },\n  };\n};\n","import {\n  section,\n  selection,\n  input,\n  slider,\n  checkbox,\n  radio,\n} from './coreComponents.js';\n\nexport default [\n  (value, update) => {\n    if (value.inputType === 'input') return input(value, update);\n  },\n  (value, update) => {\n    if (value.type === 'section') {\n      return section(value, update);\n    }\n  },\n  (value, update) => {\n    if (value.type === 'boolean') return checkbox(value, update);\n  },\n  (value, update) => {\n    if (value.values) {\n      if (value.inputType === 'radio') return radio(value, update);\n      if (value.inputType === 'selection') return selection(value, update);\n      if (value.values.length < 5) return radio(value, update);\n      else return selection(value, update);\n    }\n  },\n  (value, update) => {\n    if (\n      value.type === 'number' &&\n      !value.values &&\n      typeof value.min === 'number' &&\n      typeof value.max === 'number' &&\n      (!value.steps || value.steps >= (value.min + value.max) / 1000) // no slider for big values\n    )\n      return slider(value, update);\n  },\n  (value, update) => {\n    return input(value, update);\n  },\n];\n","import { cast } from './utils.js';\nimport coreTypeHandler from './coreTypeHandler.js';\nimport './main.scss';\n\nconst componentUpdater = new Map();\n\nconst bindElements = (\n  template,\n  store,\n  htmlElements,\n  typeHandler,\n  onValueUpdated\n) => {\n  Object.values(template).forEach(templateComponent => {\n    const { id, type, defaultValue, options, onUpdate } = templateComponent;\n    for (const handle of typeHandler) {\n      const wrapper = handle(templateComponent, newValue => {\n        newValue = cast(newValue, type);\n        if (newValue !== 0 && newValue !== false && !newValue) {\n          newValue = defaultValue || null;\n        }\n\n        if (typeof onUpdate === 'function') {\n          const v = onUpdate(newValue, store[id]);\n          store[id] = v !== undefined ? v : newValue;\n        } else store[id] = newValue;\n        onValueUpdated(id, newValue);\n      });\n\n      if (wrapper) {\n        if (options) {\n          htmlElements.push(...(wrapper.htmlElements || []));\n          store[id] = {};\n          bindElements(\n            options,\n            store[id],\n            htmlElements,\n            typeHandler,\n            onValueUpdated\n          );\n          return;\n        }\n\n        if (typeof wrapper.onStoreUpdate === 'function') {\n          componentUpdater.set(id, wrapper.onStoreUpdate);\n        }\n\n        store[id] = defaultValue || null;\n\n        htmlElements.push(...(wrapper.htmlElements || []));\n        break;\n      }\n    }\n  });\n};\n\nconst SettingsUI = ({ plugins = [] } = {}) => {\n  const changeListener = [];\n  const htmlElements = [];\n  let _store = null;\n  return {\n    bind(template, store = {}) {\n      bindElements(\n        template,\n        store,\n        htmlElements,\n        [...plugins, ...coreTypeHandler],\n        (id, newValue) => changeListener.forEach(l => l(id, newValue))\n      );\n      _store = store;\n      return store;\n    },\n    addChangeListener(listener) {\n      changeListener.push(listener);\n    },\n    removeChangeListener(listener) {\n      changeListener.splice(changeListener.indexOf(listener));\n    },\n    render(tag = 'div') {\n      const wrapper = document.createElement(tag);\n      wrapper.className = 'settings-ui-wrapper';\n      htmlElements.forEach(e => wrapper.appendChild(e));\n      return {\n        to(element) {\n          element.appendChild(wrapper);\n          return wrapper;\n        },\n        replace(element) {\n          element.parentElement.replaceChild(wrapper, element);\n          return wrapper;\n        },\n        get() {\n          return wrapper;\n        },\n      };\n    },\n    update(id) {\n      if (id) {\n        componentUpdater.get(id)(_store[id]);\n        changeListener.forEach(l => l(id, _store[id]));\n      } else {\n        const updatePartial = object => {\n          Object.entries(object).forEach(([key, value]) => {\n            if (value && typeof value === 'object') {\n              updatePartial(value);\n              return;\n            }\n            componentUpdater.get(key)(value);\n            changeListener.forEach(l => l(key, value));\n          });\n        };\n        updatePartial(_store);\n      }\n    },\n  };\n};\n\nexport default SettingsUI;\n"],"names":["cast","value","type","parseFloat","input","update","id","name","help","defaultValue","min","max","steps","htmlElements","elementCreator","document","createElement","minLength","maxLength","placeholder","addEventListener","e","target","label","innerHTML","htmlFor","push","onStoreUpdate","newValue","selection","values","select","title","forEach","v","option","appendChild","radio","checked","find","tagName","inputType","checkbox","length","step","output","slider","componentUpdater","Map","plugins","changeListener","_store","bind","template","store","bindElements","typeHandler","onValueUpdated","Object","templateComponent","options","onUpdate","wrapper","handle","undefined","set","coreTypeHandler","l","addChangeListener","listener","removeChangeListener","splice","indexOf","render","tag","className","to","element","replace","parentElement","replaceChild","get","updatePartial","object","entries","key"],"mappings":"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"}