{"version":3,"file":"index.mjs","sources":["../../src/utils.js","../../src/coreTypeHandler.js","../../src/coreComponents.js","../../src/SettingsUI.js"],"sourcesContent":["export const cast = (value, type) => {\n  switch (type) {\n    case 'number':\n      return parseFloat(value);\n    case 'text':\n      return value + '';\n  }\n  return value;\n};\n","import { section, selection, input } from './coreComponents.js';\n\nexport default [\n  (value, update) => {\n    if (value.type === 'section') {\n      return section(value, update);\n    }\n  },\n  (value, update) => {\n    if (value.values) {\n      return selection(value, update);\n    }\n  },\n  (value, update) => {\n    return input(value, update);\n  },\n];\n","export const section = ({ id, name }) => {\n  const elementCreator = type => document.createElement(type);\n  const e = elementCreator('b');\n  e.innerHTML = name || id;\n  return {\n    elements: [e],\n    superType: true,\n  };\n};\n\nexport const input = (\n  { id, name, type = 'text', help, defaultValue, min, max, steps },\n  update\n) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const input = elementCreator('input');\n  input.type = type;\n  input.id = id;\n  if (type === 'number') {\n    input.min = min || 0;\n    if (max || max === 0) input.max = max;\n    if (steps) input.step = steps;\n  } else {\n    input.minLength = min || 0;\n    if (max) input.maxLength = max;\n  }\n  input.placeholder = help || defaultValue || '';\n  if (defaultValue || defaultValue === 0) input.value = defaultValue;\n\n  input.addEventListener('input', e => update(e.target.value));\n\n  const label = elementCreator('label');\n  label.innerHTML = name || id;\n  label.htmlFor = id;\n\n  htmlElements.push(label);\n  htmlElements.push(input);\n  return { htmlElements };\n};\n\nexport const selection = ({ id, name, help, values, defaultValue }, update) => {\n  const htmlElements = [];\n  const elementCreator = type => document.createElement(type);\n\n  const select = elementCreator('select');\n  select.id = id;\n  select.title = help || '';\n\n  values.forEach(v => {\n    const option = elementCreator('option');\n    if (typeof v === 'object') {\n      option.value = v.value;\n      option.innerHTML = v.name;\n    } else {\n      option.value = option.innerHTML = v;\n    }\n    select.appendChild(option);\n  });\n\n  if (defaultValue || defaultValue === 0) select.value = defaultValue;\n\n  select.addEventListener('input', e => update(e.target.value));\n\n  const label = document.createElement('label');\n  label.htmlFor = id;\n  label.innerHTML = name || id;\n\n  htmlElements.push(label);\n  htmlElements.push(select);\n\n  return { htmlElements };\n};\n","import { cast } from './utils.js';\nimport coreTypeHandler from './coreTypeHandler.js';\nimport './main.scss';\n\nconst bindElements = (\n  template,\n  config,\n  htmlElements,\n  typeHandler,\n  onValueUpdated\n) => {\n  Object.values(template).forEach(templateComponent => {\n    const { id, type, defaultValue, options, onUpdate } = templateComponent;\n    for (const handle of typeHandler) {\n      const wrapper = handle(templateComponent, newValue => {\n        newValue = cast(newValue, type);\n        if (newValue !== 0 && !newValue) {\n          newValue = defaultValue || null;\n        }\n\n        if (typeof onUpdate === 'function') {\n          const v = onUpdate(newValue, config[id]);\n          config[id] = v !== undefined ? v : newValue;\n        } else config[id] = newValue;\n        onValueUpdated(id, newValue);\n      });\n\n      if (wrapper) {\n        if (wrapper.superType) {\n          htmlElements.push(...(wrapper.htmlElements || []));\n          config[id] = {};\n          bindElements(\n            options,\n            config[id],\n            htmlElements,\n            typeHandler,\n            onValueUpdated\n          );\n          return;\n        }\n\n        config[id] = defaultValue || null;\n\n        htmlElements.push(...(wrapper.htmlElements || []));\n        break;\n      }\n    }\n  });\n};\n\nconst SettingsUI = ({ plugins = [] } = {}) => {\n  const changeListener = [];\n  const htmlElements = [];\n  return {\n    bind(template, config = {}) {\n      bindElements(\n        template,\n        config,\n        htmlElements,\n        [...coreTypeHandler, ...plugins],\n        (id, newValue) => changeListener.forEach(l => l(id, newValue))\n      );\n      return config;\n    },\n    addChangeListener(listener) {\n      changeListener.push(listener);\n    },\n    removeChangeListener(listener) {\n      changeListener.splice(changeListener.indexOf(listener));\n    },\n    render(tag = 'div') {\n      const wrapper = document.createElement(tag);\n      wrapper.className = 'settings-ui-wrapper';\n      htmlElements.forEach(e => wrapper.appendChild(e));\n      return {\n        to(element) {\n          element.appendChild(wrapper);\n          return wrapper;\n        },\n        replace(element) {\n          element.parentElement.replaceChild(wrapper, element);\n          return wrapper;\n        },\n        get() {\n          return wrapper;\n        },\n      };\n    },\n  };\n};\n\nexport default SettingsUI;\n"],"names":["const","cast","value","type","parseFloat","update","e","document","createElement","innerHTML","name","id","elements","superType","values","htmlElements","elementCreator","select","title","help","forEach","v","option","appendChild","defaultValue","addEventListener","target","label","htmlFor","push","selection","input","min","max","steps","step","minLength","maxLength","placeholder","bindElements","template","config","typeHandler","onValueUpdated","Object","templateComponent","wrapper","handle","newValue","onUpdate","undefined","options","changeListener","bind","coreTypeHandler","plugins","l","addChangeListener","listener","removeChangeListener","splice","indexOf","render","tag","className","to","element","replace","parentElement","replaceChild","get"],"mappings":"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"}